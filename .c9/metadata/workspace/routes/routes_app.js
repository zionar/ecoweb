{"filter":false,"title":"routes_app.js","tooltip":"/routes/routes_app.js","undoManager":{"mark":26,"position":26,"stack":[[{"start":{"row":1,"column":0},"end":{"row":1,"column":42},"action":"remove","lines":["var Imagen = require(\"../model/imagenes\");"],"id":2}],[{"start":{"row":0,"column":33},"end":{"row":1,"column":0},"action":"remove","lines":["",""],"id":3}],[{"start":{"row":4,"column":0},"end":{"row":5,"column":33},"action":"remove","lines":["","var client =redis.createClient();"],"id":4}],[{"start":{"row":5,"column":0},"end":{"row":17,"column":0},"action":"remove","lines":["","var image_finder_middleware = require(\"../middleware/find_imagen\");","router.get(\"/\",function(req,res){","\tImagen.find({}).populate(\"creator\").","\texec(function(err,imagenes){","\t\tif(err) console.log(err);","\t\tres.render(\"app/home\",{imagenes:imagenes})","\t})","\t","})","","/* REST */",""],"id":5}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":1},"action":"insert","lines":["/"],"id":6}],[{"start":{"row":6,"column":1},"end":{"row":6,"column":2},"action":"insert","lines":["/"],"id":7}],[{"start":{"row":25,"column":0},"end":{"row":36,"column":0},"action":"remove","lines":["\tres.locals.imagen.title = req.body.title","\tres.locals.imagen.save(function(err){","\t\tif(!err)","\t\t{","\t\t\tres.render(\"app/imagenes/show\");","\t\t}","\t\telse","\t\t{","      res.render(\"app/imagenes/\"+req.params.id+\"/edit\");","","\t\t}",""],"id":8},{"start":{"row":25,"column":0},"end":{"row":26,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":3},"action":"remove","lines":["\t})"],"id":9}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":25,"column":0},"end":{"row":26,"column":0},"action":"remove","lines":["",""],"id":11}],[{"start":{"row":30,"column":0},"end":{"row":40,"column":2},"action":"remove","lines":["Imagen.findOneAndRemove({_id:req.params.id},function(err){","","if(!err)","\t{","\t\tres.redirect(\"/app/imagenes\");","\t}","\telse","\t{","  \t\t\tconsole.log(err);","  \t\t\tres.redirect(\"/app/imagenes\"+req.params.id);","\t}"],"id":12}],[{"start":{"row":31,"column":0},"end":{"row":32,"column":3},"action":"remove","lines":["","});"],"id":13}],[{"start":{"row":30,"column":0},"end":{"row":31,"column":0},"action":"remove","lines":["",""],"id":14}],[{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"remove","lines":["",""],"id":15}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":32},"action":"remove","lines":["\tres.render(\"app/imagenes/new\");"],"id":16}],[{"start":{"row":13,"column":2},"end":{"row":13,"column":34},"action":"remove","lines":["res.render(\"app/imagenes/edit\");"],"id":17}],[{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"remove","lines":["",""],"id":18}],[{"start":{"row":35,"column":0},"end":{"row":37,"column":56},"action":"remove","lines":[" Imagen.find({},function(err,imagenes){","   if(err){res.redirect(\"/app\");return;}","   res.render(\"app/imagenes/index\",{imagenes:imagenes});"],"id":20}],[{"start":{"row":42,"column":5},"end":{"row":65,"column":3},"action":"remove","lines":["ar extencion =req.body.archivo.name.split(\".\").pop();","\tvar imagen = new Imagen({title:req.body.title,creator:res.locals.user._id,extension:extencion});","","\timagen.save(function(err)","\t{","\t\tif(!err)","\t\t{  ","","\t\t       var imgJSON={","          \"id\":imagen._id,","          \"title\": imagen.title,","          \"estension\":imagen.extension","       }","","","\t\t   client.publish(\"images\",JSON.stringify(imgJSON)); ","\t\t\tfs.rename(req.body.archivo.path ,\"public/imagenes/\"+imagen._id+\".\"+extencion)","\t\t\tres.redirect(\"/app/imagenes/\"+imagen._id);","\t\t}","\t\telse","\t\t{\t","\t\t\tres.render(err);","\t\t}","\t})"],"id":21}],[{"start":{"row":42,"column":4},"end":{"row":42,"column":5},"action":"remove","lines":["v"],"id":22}],[{"start":{"row":42,"column":3},"end":{"row":42,"column":4},"action":"remove","lines":[" "],"id":23}],[{"start":{"row":33,"column":0},"end":{"row":43,"column":3},"action":"remove","lines":["router.route(\"/imagenes\")",".get(function(req,res){","",""," });","","})",".post(function(req,res)","{","   ","});"],"id":24}],[{"start":{"row":6,"column":55},"end":{"row":7,"column":0},"action":"remove","lines":["",""],"id":25}],[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["",""],"id":26}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":27}],[{"start":{"row":34,"column":0},"end":{"row":35,"column":0},"action":"remove","lines":["",""],"id":28}],[{"start":{"row":33,"column":0},"end":{"row":34,"column":0},"action":"remove","lines":["",""],"id":29}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":7,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1498340259317,"hash":"325e4c3b3aab1ffbf05adefee6a06799afc63fd6"}